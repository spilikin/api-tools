{
  "$id": "urn:gematik:api:schema:ApprovalObject",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "ApprovalObject (Zulassungsobjekt/Produkttyp)",
  "type": "object",
  "properties": {
    "apiVersion": { "const": "v1" },
    "kind": { "const": "ApprovalObject" },
    "meta": { "$ref": "#/$defs/meta" },
    "spec": { "$ref": "#/$defs/spec" }
  },
  "required": [ "apiVersion", "kind", "meta"],

  "$defs": {
    "meta": { 
      "type": "object",
      "properties": {
        "name": {
          "anyOf": [
            { "$ref": "Produkttyp.schema.json" },
            { "type": "string" }
          ]
        },
        "version": { "type": "string"},
        "description": { "type": "string"}
      },
      "required": [ "name", "version"]
    },
    "spec": {
      "type": "object",
      "properties": {
        "components": { 
          "type": "array",
          "items": {
            "$ref": "#/$defs/component" 
          }
        },
        "providesInterfaces": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/provided-interface"
          }
        }
      },
      "requiresInterfaces": {
        "type": "array",
        "items": {
          "$ref": "#/$defs/required-interface"
        }
      }
  },
    "component": {
      "type": "object",
      "properties": {
        "name": {"type": "string"},
        "provides": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/provided-interface"
          }
        },
        "requires": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/required-interface"
          }
        }
      },
      "required": [ "name"]
    },
    "provided-interface": {
      "type": "object",
      "properties": {
        "name": {"type": "string"},
        "version": {"type": "string"},
        "title": {"type": "string"},
        "description": {"type": "string"}
      },
      "required": [ "name"]
    },
    "required-interface": {
      "type": "object",
      "properties": {
        "providedBy": {
          "anyOf": [
            { "$ref": "Produkttyp.schema.json" },
            { "type": "string" }
          ]
        },
        "fromVersion": {"type": "string"},
        "toVersion": {"type": "string"},
        "interfaceName": {"type": "string"},
        "interfaceVersion": {"type": "string"},
        "description": {"type": "string"}
      },
      "required": [ "providedBy", "interfaceName"]
    }
  }
}