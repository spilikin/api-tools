<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: gematik API</title>
    <link rel="canonical" href="https://spilikin.dev/api-tools/api-erp/1.2/ti_configuration.html">
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://spilikin.dev/api-tools">gematik API</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="https://github.com/gematik/"><img style="height: 1.4em;margin-right: 0.4em;" src="../../_/img/github-mark-white.svg"> GiHub</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/gematik/api-telematik">Telematik API</a>
            <a class="navbar-item" href="https://github.com/gematik/api-erp">eRP API</a>
            <a class="navbar-item" href="https://github.com/gematik/api-epa">ePA API</a>
            <a class="navbar-item" href="https://github.com/gematik/api-kim/">KIM API</a>
            <a class="navbar-item" href="https://github.com/gematik/api-ti-messenger/">TI-Messenger API</a>
            <a class="navbar-item" href="https://github.com/gematik/api-vzd/">Directory API</a>
          </div>
        </div>
        <a class="navbar-item" href="https://fachportal.gematik.de/">Fachportal</a>
        <div class="navbar-item" style="scale: 1;">
          <span class="control">
            <img class="logo" src="../../_/img/gematik_logo_text.svg">
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="api-erp" data-version="1.2">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">ePrescription API</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">index.adoc</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ePrescription API</span>
    <span class="version">1.2</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="index.html">ePrescription API</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">1.2</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../api-directory-fhir/1.0.0/index.html">FHIR Directory API</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../api-directory-fhir/1.0.0/index.html">1.0.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../api-directory-ldap/1.7.0/index.html">LDAP Directory API</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../api-directory-ldap/1.7.0/index.html">1.7.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../api-telematik/5.5.0/overview/index.html">Telematik API</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../api-telematik/5.5.0/overview/index.html">5.5.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../api-ti-messenger/1.1.0/index.html">TI-Messenger API</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../api-ti-messenger/1.1.0/index.html">1.1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../api-telematik/5.5.0/overview/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/spilikin/poc-api-telematik/edit/erp/src/antora/modules/ROOT/pages/ti_configuration.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="paragraph">
<p><span class="image"><img src="_images/gematik_logo.png" alt="gematik logo" width="35%"></span></p>
</div>
<div class="sect1">
<h2 id="_e_rezept_api_dokumentation"><a class="anchor" href="#_e_rezept_api_dokumentation"></a>E-Rezept API-Dokumentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hier gibt die gematik eine Hilfestellung zur Konfiguration des lokalen Netzwerkes der Leistungserbringerumgebung.
Damit können Primärsysteme die Dienste der Telematikinfrastruktur über das Netzwerkrouting erreichen und
die Namensauflösung (DNS) der TI verwenden, um zu den TI-Adressen z.B. <code><a href="https://erp.zentral.erp.splitdns.ti-dienste.de" class="bare">https://erp.zentral.erp.splitdns.ti-dienste.de</a></code> die IP-Adressen der Fachdienst zu erfahren.</p>
</div>
<div class="paragraph">
<p>Primärsysteme erreichen den IDP und E-Rezept-Fachdienst über den Konnektor (IP-Adressbereich "offene Fachdienste"). In Netzwerkkonfigurationen, in denen der Konnektor nicht "in Reihe geschaltet" ist, sind die folgenden Punkte zu beachten. Den Primärsystemen (bzw. den Computern auf denen sie installiert sind - Host) muss über eine Netzwerkkonfiguration (z.B. über DHCP) ein DNS-Resolver und ein Default-Gateway für das Routing mitgeteilt werden.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
Das geschlossene Netz des digitalen Gesundheitswesens nutzt IP-Adressen, die ebenso außerhalb des geschlossenen Netzes und im Internet benutzt werden können. Es ist nicht auszuschließen, dass es dabei zu Konflikten in der Adressierung von einzelnen Diensten kommen kann.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konfiguration_des_routings"><a class="anchor" href="#_konfiguration_des_routings"></a>Konfiguration des Routings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Der Host-Computer des Primärsystems kennt ein Default-Gateway, an das ausgehende Datenpakete für das weitere Routing in Richtung Zieladresse geschickt werden. Für Ziele in der Telematikinfrastruktur müssen diese Datenpakete zum Konnektor geschickt werden, der je nach Netzwerkkonfiguration nicht das Default-Gateway ist.</p>
</div>
<div class="paragraph">
<p>Die Lösung besteht im Einrichten einer Weiterleitung für Zieladressen in der TI, sodass Datenpakete mit einer Zieladresse für bspw. offene Fachdienste vom Default-Gateway des Netzwerkes nicht ins Internet, sondern an den Konnektor weitergeleitet werden.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Ziele</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Adressbereiche</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>offene Fachdienste</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>100.102.0.0/17</code><br>
<code>100.103.0.0/16</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>aAdG und aAdG NetG-TI</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>100.102.128.0/17</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><strong>Die Routen für offene Fachdienste und aAdG + aAdG NetG-TI lassen sich zusammenfassen zu <span class="red yellow-background">100.102.0.0/15</span>, um nur eine Route konfigurieren zu müssen.<br>
Für die Referenzumgebung RU ist der Adressbereich mit <code>10.30.0.0/15</code> zu konfigurieren.</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>aAdG-NetG (<strong>Bestandsnetze</strong>)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>siehe lokale Repo-Datei <a href="../config/Konnektor_Bestandsnetze.xml">Konnektor_Bestandsnetze.xml</a> (Version 2.1.6 - April 2021),<br>
Umzug ins gematik-git-Account demnächst geplant)</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
Die Weiterleitung kann Segmentweise eingerichtet werden und muss nicht für jede Zieladresse einzeln erfolgen (übergreifende Routen).
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
Die Liste der erreichbaren aAdG (<strong>WANDA</strong>) wird regelmäßig aktualisiert, wenn im Rahmen der Bestätigung neuer Anbieter Adressbereiche des Anbieters hinzukommen.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Je nach Art und Größe des lokal verwalteten Netzwerks der Leistungserbringerumgebung kommt im Gateway unterschiedliche Hard- und Software zum Einsatz. Einige lassen sich über die Kommandozeile admnistrieren, andere besitzen eine eigene API (z.B. Fritzbox, Speedport) und in bestimmten Fällen lässt sich die Konfiguration über ein UserInterface einrichten.</p>
</div>
<div class="sect2">
<h3 id="_fritzbox_konfiguration"><a class="anchor" href="#_fritzbox_konfiguration"></a>FritzBox-Konfiguration</h3>
<div class="paragraph">
<p>Im Folgenden ist die Konfiguration einer Fritzbox über die grafische Benutzeroberfläche im Browser dargestellt.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/fritzbox_1.png" alt="fritzbox 1" width="100%"></span>
Öffnen sie die Netzwerkeinstellungen und wählen sie für <code>Statische Routingtabelle</code> die IP-Version des lokalen Netzwerks</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/fritzbox_2.png" alt="fritzbox 2" width="100%"></span>
Wählen Sie das Hinzufügen einer neuen statischen Route (im Bsp. für IPv4-Routen)</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/fritzbox_3.png" alt="fritzbox 3" width="100%"></span>
Tragen sie bei <strong>Netzwerk</strong> den Adressbereich für z.B "Offene Fachdienste* wie oben angegeben ein.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
Das Präfix <code>/16</code> bedeutet eine Subnetz-Maske von <code>255.255.0.0</code>,<br>
im Beispiel ist <code>10.10.10.1</code> die IP-Adresse des Konnektors im lokalen Netzwerk.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
Fügen Sie weitere Routen hinzu für die Bestandsnetze und aAdG.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Zusätzlich stellt AVM standardisierte <a href="https://avm.de/service/schnittstellen/">Schnittstellen (TR-064)</a> bereit, um die Netzwerkkonfiguration ggfs. auch automatisiert durchführen zu können:<br>
<a href="https://avm.de/fileadmin/user_upload/Global/Service/Schnittstellen/layer3forwardingSCPD.pdf" class="bare">https://avm.de/fileadmin/user_upload/Global/Service/Schnittstellen/layer3forwardingSCPD.pdf</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_konfiguration_eines_linux_basierten_gateways"><a class="anchor" href="#_konfiguration_eines_linux_basierten_gateways"></a>Konfiguration eines Linux-basierten Gateways</h3>
<div class="paragraph">
<p>In größeren Netzwerken kommt mitunter eine gegenüber einer z.B. Fritzbox leistungsstärkere Hard- und Software in Form von Linux-Servern zum Einsatz. Diese lassen sich meist über die Kommandozeile administrieren.</p>
</div>
<div class="paragraph">
<p>Mit folgendem Shell-Kommando lassen sich die Routen für z.B. offene Fachdienste statisch festlegen:</p>
</div>
<div class="paragraph">
<p><code>$ ip route add 100.102.0.0/15 via 10.10.10.1 dev eth0</code><br>
seien dabei <strong>10.10.10.1</strong> die Konnektoradresse im lokalen Netz und <strong>eth0</strong> der verwendete Netzwerkinterface-Name</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
Für die Persistierung der statischen Routen ist darauf zu achten, welche Distribution verwendet wird und es sind die dazugehörigen Konfigurationen vorzunehmen.<br>
Andernfalls ist diese Netzwerkkonfiguration nach jedem Neustart zu tätigen.<br>
- Bspw. CentOS erlaubt das Erstellen von Skripten für die Netzwerkkonfiguration<br>
- Bspw. Ubuntu nutzt netplan, wo die Netzwerkkonfiguration in einer Netplan-Datei erfolgt
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_konfiguration_der_dns_namensauflösung"><a class="anchor" href="#_konfiguration_der_dns_namensauflösung"></a>Konfiguration der DNS-Namensauflösung</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Über die Namensauflösung werden FQDNs (z.B. <code>erp.zentral.erp.splitdns.ti-dienste.de</code> für den E-Rezept-Fachdienst) in IP-Adressen für das Routing übersetzt. Werden bpw. für die Lastverteilung oder zur Ausfallsicherheit mehrere Serverknoten eingesetzt, liefert die Namensauflösung für einen FQDN mehrere IP-Adressen zurück. Die folgende Abbildung zeigt eine Übersicht der verwendeten Namensdienste.</p>
</div>
<div class="paragraph">
<p><span class="image unresolved"><img src="../images/erx_dns.png" alt="erx dns" width="100%"></span></p>
</div>
<div class="paragraph">
<p>In Netzwerken, in denen der Konnektor in Reihe geschaltet ist, kann dieser Ziel-Adressen in der TI über ein DNS-Forward vom Namensdienst der TI auflösen lassen. Für Zieladressen außerhalb der TI nutzt der Konnektor die Namensdienste im Internet.</p>
</div>
<div class="paragraph">
<p>In lokalen Netzwerken mit Parallelschaltung des Konnektors nutzen die Clients denjenigen DNS-Server, der ihnen im Rahmen der Netzwerkkonfiguration zugewiesen wird.
Für das E-Rezept müssen die folgenden beiden FQDNs in IP-Adressen aufgelöst werden können:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title=":heavy_exclamation_mark:"></i>
</td>
<td class="content">
<code>erp.zentral.erp.splitdns.ti-dienste.de</code> für den E-Rezept-Fachdienst<br>
<code>idp.zentral.idp.splitdns.ti-dienste.de</code> für den IdentityProvider (IDP)
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title=":information_source:"></i>
</td>
<td class="content">
Weitere Telematikadressen werden unter anderem unter der Domains <code>*.telematik</code> geführt.<br>
Die Adresse des Apothekenverzeichnisses apovzd.zentral.erp.splitdns.ti-dienste.de wird von den Primärsystemen nicht genutzt.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_konnektor_für_namensauflösung_im_lokalen_netz"><a class="anchor" href="#_konnektor_für_namensauflösung_im_lokalen_netz"></a>Konnektor für Namensauflösung im lokalen Netz</h3>
<div class="paragraph">
<p>Eine Variante der direkten Namensauflösung für Adressen der Telematikinfrastruktur ist, den Konnektor als primären DNS-Server über die Netzwerkkonfiguration durch den DHCP-Server in den Clients festzulegen. FQDNs der TI werden dann vom Konnektor durch den Namensdienst der TI aufgelöst, alle übrigen Adressen löst der Konnektor durch einen Namensdienst im Internet auf. Diese Funktionsweise stellt sich wie eine Reihenschaltung dar, nur dass der Konnektor nicht das Default-Gateway der Clients ist.</p>
</div>
</div>
<div class="sect2">
<h3 id="_anderer_dns_resolver_im_lokalen_netz"><a class="anchor" href="#_anderer_dns_resolver_im_lokalen_netz"></a>Anderer DNS-Resolver im lokalen Netz</h3>
<div class="paragraph">
<p>Die Alternative dazu nutzt den Konnektor für die Namensauflösung nicht direkt. In Netzwerken mit eigenem Domain Controler lässt sich ein domain-spezifischer Forwarder konfigurieren, mit dem die Adressen <code>splitdns.ti-dienste.de</code> und die Adressen mit <code>*.telematik</code> über den Konnektor in IP-Adresssen der TI aufgelöst werden können.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright &copy; <script>document.write(new Date().getFullYear())</script> gematik GmbH</p>
  <p>Generated using Antora and Asciidoc.</p>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
